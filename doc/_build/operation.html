
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Operation &#8212; Ballot Tally 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Installation" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="operation">
<h1>Operation<a class="headerlink" href="#operation" title="Permalink to this headline">¶</a></h1>
<p>This section lists the executable programs that accomplish the steps outlined in Concept of Operations and some other utilities.</p>
<section id="general-information">
<h2>General Information<a class="headerlink" href="#general-information" title="Permalink to this headline">¶</a></h2>
<section id="image-file-directory-structure">
<span id="filestruc"></span><h3>Image File Directory Structure<a class="headerlink" href="#image-file-directory-structure" title="Permalink to this headline">¶</a></h3>
<p>The image files are arranged in a directory tree with 1000 images per subdirectory. The subdirectory name is the first three digits of the file named.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">location</span><span class="o">/</span>
    <span class="mi">000</span><span class="o">/</span>
        <span class="mf">000000.</span><span class="n">jpg</span>
        <span class="mf">000001.</span><span class="n">jpg</span>
        <span class="o">...</span>
        <span class="mf">000999.</span><span class="n">jpg</span>
    <span class="mi">001</span><span class="o">/</span>
        <span class="mf">001000.</span><span class="n">jpg</span>
        <span class="mf">001001.</span><span class="n">jpg</span>
        <span class="o">...</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="major-data-base-tables">
<h3>Major Data Base Tables<a class="headerlink" href="#major-data-base-tables" title="Permalink to this headline">¶</a></h3>
<p>The following tables are significant in the processing flow.</p>
<table class="colwidths-given docutils align-left" id="id1">
<caption><span class="caption-text">Major Database Tables</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Table</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Images</p></td>
<td><p>Tracks the state of an image through the processing steps.</p>
<p>Primary key: image number</p>
</td>
</tr>
<tr class="row-odd"><td><p>(Other)</p></td>
<td><p>(to be added later)</p></td>
</tr>
</tbody>
</table>
<p>The associated MySQL database has two schemas. Currently production work is run in the database named “testing”.</p>
</section>
<section id="external-inputs">
<h3>External Inputs<a class="headerlink" href="#external-inputs" title="Permalink to this headline">¶</a></h3>
<p>In addition to the images, the following data is imported through .csv or .tsv files.
1 The exact spelling of contest names and the corresponding choices is used in generating templates.
2 A table relating a subfield of the barcodes to precinct ID
3 A table relating a subfield of the barcodes to party
4 Canvas results (i.e., the official result of the election).</p>
<p>This information is provided by the Humboldt County elections department.</p>
<p>In theory, the information in (1) and (4) could be obtained by scraping various public web sites and (2) and (3) could be created by using OCR on the ballots during the creation of templates. However we have not found open source OCR that makes this easy.</p>
<p>In theory, OCR could eliminate the requirement for (2) and (3) altogether but the same issue about the quality of OCR makes using the barcodes more reliable.</p>
</section>
<section id="global-parameters">
<h3>Global Parameters<a class="headerlink" href="#global-parameters" title="Permalink to this headline">¶</a></h3>
<p>The source file GLB_globs.py contains a number of static globals including paths to specific input and output directories.</p>
</section>
</section>
<section id="scanning">
<h2>Scanning<a class="headerlink" href="#scanning" title="Permalink to this headline">¶</a></h2>
<p>The control program for scanning is currently a separate project written in Python 2.7. Its output is a set of files described in <a class="reference internal" href="#image-file-directory-structure">Image File Directory Structure</a>. These files are never modified by any downstream process so that the creation date matches manual logs created during scanning.</p>
<p>(This program is currently not in this repository.)</p>
</section>
<section id="ballot-classification">
<h2>Ballot Classification<a class="headerlink" href="#ballot-classification" title="Permalink to this headline">¶</a></h2>
<p><strong>discover_new_images.py</strong></p>
<p>This daemon periodically checks the image directory for images that are not already present in the images table. If it finds new ones it adds them to the table. Multiple copies of this program should not be run at the same time, but it the single copy can run in parallel with process_barcodes.py.</p>
<p><strong>process_barcodes.py</strong></p>
<p>This daemon discovers new entries in the images table and examines the barcodes in the corresponding image to determine the precinct, page number, and party associated with the ballot. This information is added to the entries in the images table.</p>
<p>Multiple copies of process_barcodes.py may run in parallel to achieve substantial performance improvements.</p>
<p id="hetp-main-py"><strong>HETP_main.py</strong></p>
<p>This program is capapble of launching daemon processes from a list of programs. The list specifies how many copies of the program should be run simultaneously. It could support operating all of these processing steps in parallel. Scanning, Ballot classification, ballot classification, ballot decoding, and vote determination.</p>
<p>However, scanning is actually run on a different computer than all the other steps, that computer being in a controlled access area of the elections department. Data is then transferred by sneakernet to an off-site computer where the other steps are processed.</p>
</section>
<section id="ballot-templating">
<h2>Ballot Templating<a class="headerlink" href="#ballot-templating" title="Permalink to this headline">¶</a></h2>
<p>Templates are created for each combination of precinct, page number, and party using a semi-automated process to be described here later.</p>
</section>
<section id="ballot-decoding-and-vote-determination">
<h2>Ballot Decoding and Vote Determination<a class="headerlink" href="#ballot-decoding-and-vote-determination" title="Permalink to this headline">¶</a></h2>
<p><strong>process_votes.py</strong></p>
<p>process_votes.py discovers entries in the images table that have identified precinct, page nuber, and party but where the votes have not been determined. For each some issues, it normalizes the image against the template, determines the scores for each sense area and then determines which sense areas are marked. For any contest it may also set a boolean value indicating that the marking is uncertain.</p>
<p>This program calls on two modules: ballot_scanner does the heavy lifting of determining the scores and marks_from_scores accepts the scores for a contest and decides which choices were selected. It also may indicate that a contest was undervoted, overvotes, or whether the score determination is uncertain.</p>
</section>
<section id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h2>
<p><strong>dbase.report_comparison_newer()</strong></p>
<p>This is a function in the dbase module that produces the primary output report. Currently it is run if you run the dbase.py file as a main program.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Ballot Tally</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="concept_of_ops.html">Concept of Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Operation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-information">General Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scanning">Scanning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ballot-classification">Ballot Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ballot-templating">Ballot Templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ballot-decoding-and-vote-determination">Ballot Decoding and Vote Determination</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analysis">Analysis</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="installation.html" title="previous chapter">Installation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Wes Rishel, David McCallie.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/operation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>